/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/ai-advisor/route";
exports.ids = ["app/api/ai-advisor/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("events");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("fs");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("net");

/***/ }),

/***/ "node:crypto":
/*!******************************!*\
  !*** external "node:crypto" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:crypto");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:fs");

/***/ }),

/***/ "node:stream":
/*!******************************!*\
  !*** external "node:stream" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:stream");

/***/ }),

/***/ "node:stream/web":
/*!**********************************!*\
  !*** external "node:stream/web" ***!
  \**********************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:stream/web");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("path");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

"use strict";
module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("stream");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("tls");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("util");

/***/ }),

/***/ "worker_threads":
/*!*********************************!*\
  !*** external "worker_threads" ***!
  \*********************************/
/***/ ((module) => {

"use strict";
module.exports = require("worker_threads");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("zlib");

/***/ }),

/***/ "?32c4":
/*!****************************!*\
  !*** bufferutil (ignored) ***!
  \****************************/
/***/ (() => {

/* (ignored) */

/***/ }),

/***/ "?66e9":
/*!********************************!*\
  !*** utf-8-validate (ignored) ***!
  \********************************/
/***/ (() => {

/* (ignored) */

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fai-advisor%2Froute&page=%2Fapi%2Fai-advisor%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fai-advisor%2Froute.ts&appDir=%2FUsers%2Fryomatakahashi%2Fapp01-2%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fryomatakahashi%2Fapp01-2&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fai-advisor%2Froute&page=%2Fapi%2Fai-advisor%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fai-advisor%2Froute.ts&appDir=%2FUsers%2Fryomatakahashi%2Fapp01-2%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fryomatakahashi%2Fapp01-2&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_ryomatakahashi_app01_2_src_app_api_ai_advisor_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/ai-advisor/route.ts */ \"(rsc)/./src/app/api/ai-advisor/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/ai-advisor/route\",\n        pathname: \"/api/ai-advisor\",\n        filename: \"route\",\n        bundlePath: \"app/api/ai-advisor/route\"\n    },\n    resolvedPagePath: \"/Users/ryomatakahashi/app01-2/src/app/api/ai-advisor/route.ts\",\n    nextConfigOutput,\n    userland: _Users_ryomatakahashi_app01_2_src_app_api_ai_advisor_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/ai-advisor/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZhaS1hZHZpc29yJTJGcm91dGUmcGFnZT0lMkZhcGklMkZhaS1hZHZpc29yJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGYWktYWR2aXNvciUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRnJ5b21hdGFrYWhhc2hpJTJGYXBwMDEtMiUyRnNyYyUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGVXNlcnMlMkZyeW9tYXRha2FoYXNoaSUyRmFwcDAxLTImaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQ2E7QUFDMUY7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpRUFBaUU7QUFDekU7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUN1SDs7QUFFdkgiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZXh0LW1vdmUtcmVhbC1lc3RhdGUtYWkvP2MwMGQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiL1VzZXJzL3J5b21hdGFrYWhhc2hpL2FwcDAxLTIvc3JjL2FwcC9hcGkvYWktYWR2aXNvci9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvYWktYWR2aXNvci9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2FpLWFkdmlzb3JcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL2FpLWFkdmlzb3Ivcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMvcnlvbWF0YWthaGFzaGkvYXBwMDEtMi9zcmMvYXBwL2FwaS9haS1hZHZpc29yL3JvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS9haS1hZHZpc29yL3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fai-advisor%2Froute&page=%2Fapi%2Fai-advisor%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fai-advisor%2Froute.ts&appDir=%2FUsers%2Fryomatakahashi%2Fapp01-2%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fryomatakahashi%2Fapp01-2&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/ai-advisor/route.ts":
/*!*****************************************!*\
  !*** ./src/app/api/ai-advisor/route.ts ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n/* harmony import */ var _langchain_openai__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @langchain/openai */ \"(rsc)/./node_modules/@langchain/openai/index.js\");\n/* harmony import */ var _langchain_core_prompts__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @langchain/core/prompts */ \"(rsc)/./node_modules/@langchain/core/prompts.js\");\n/* harmony import */ var _langchain_core_output_parsers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @langchain/core/output_parsers */ \"(rsc)/./node_modules/@langchain/core/output_parsers.js\");\n\n\n\n\n\n// Supabaseクライアントを初期化\n// 環境変数が設定されていることを前提とします\nconst supabaseUrl = \"https://nsyjxvopcfvlnxupqdzo.supabase.co\";\nconst supabaseAnonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5zeWp4dm9wY2Z2bG54dXBxZHpvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIzOTQ1NjUsImV4cCI6MjA2Nzk3MDU2NX0.6PydmGcRE6ILS13HK-K_ScKii6qP42Mrfb_DXcHjaqE\";\nif (!supabaseUrl || !supabaseAnonKey) {\n    throw new Error(\"Supabase URLまたはAnon Keyが設定されていません。\");\n}\nconst supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_4__.createClient)(supabaseUrl, supabaseAnonKey);\nconst OPENAI_API_KEY = process.env.OPENAI_API_KEY;\n// よくある質問・不動産投資の基礎知識\nconst FAQ_KNOWLEDGE = [\n    \"利回りとは、年間の家賃収入を物件の購入価格で割り、100を掛けたものです。計算式: 利回り(%) = 年間家賃収入 \\xf7 購入価格 \\xd7 100\",\n    \"管理費とは、物件の維持管理にかかる費用です。マンションの場合は共用部分の清掃や修繕などに使われます。\",\n    \"修繕費は、物件の設備や建物の修理・交換にかかる費用です。\",\n    \"節税対策として、減価償却や必要経費の計上が有効です。\",\n    \"空室リスクを下げるには、立地や設備の充実、適切な家賃設定が重要です。\",\n    \"不動産投資のリスクには、空室、家賃下落、修繕費の増加、災害リスクなどがあります。\",\n    \"家賃収入は毎月の安定収入となりますが、固定資産税や管理費などの支出も考慮しましょう。\",\n    \"物件の選び方は、立地、築年数、利回り、管理状況、周辺環境などを総合的に判断します。\",\n    \"ローン返済額は、借入金額、金利、返済期間によって決まります。\",\n    \"不動産投資の出口戦略には、売却、賃貸継続、リフォーム後の再賃貸などがあります。\"\n];\nconst MARKET_NEWS_LAW = [\n    \"【市場データ】2024年7月現在、全国の平均家賃は8.2万円、空室率は12.5%です。東京都心部では家賃上昇傾向が続いています。\",\n    \"【市場データ】2024年の不動産投資市場は、低金利とインフレ期待を背景に活発化しています。\",\n    \"【不動産ニュース】「賃貸住宅の省エネ義務化、2025年から段階的に導入へ」(2024/06/30)\",\n    \"【不動産ニュース】「サブリース規制強化、オーナー保護策が拡充」(2024/07/10)\",\n    \"【不動産ニュース】「空き家対策特別措置法の改正案が成立」(2024/05/15)\",\n    \"【法令】宅地建物取引業法では、重要事項説明書の交付が義務付けられています。\",\n    \"【法令】賃貸借契約における敷金・礼金の取り扱いは、民法第622条等に基づきます。\",\n    \"【法令】2024年4月施行の改正民法により、原状回復義務の範囲が明確化されました。\"\n];\nfunction summarizeTransactions(transactions) {\n    if (!transactions || transactions.length === 0) return \"取引データはありません。\";\n    const byCategory = {};\n    transactions.forEach((t)=>{\n        const category = t.category || \"カテゴリなし\";\n        if (!byCategory[category]) byCategory[category] = 0;\n        byCategory[category] += t.amount || 0;\n    });\n    if (Object.keys(byCategory).length === 0) return \"集計可能な取引データがありません。\";\n    return \"【取引サマリー】\\n\" + Object.entries(byCategory).map(([cat, sum])=>`${cat}: 合計${sum.toLocaleString()}円`).join(\" / \");\n}\nasync function POST(req) {\n    try {\n        const { question, transactions } = await req.json();\n        if (!question) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"質問がありません\"\n            }, {\n                status: 400\n            });\n        }\n        // LangChainStreamは古い形式のため、新しいストリーミング方式に切り替えます\n        // const { stream, handlers } = LangChainStream();\n        // 1. ユーザーの質問をベクトル化\n        const embeddings = new _langchain_openai__WEBPACK_IMPORTED_MODULE_1__.OpenAIEmbeddings({\n            openAIApiKey: OPENAI_API_KEY\n        });\n        const queryEmbedding = await embeddings.embedQuery(question);\n        // 2. Supabase RPCで類似物件を検索\n        const { data: matchedProperties, error: rpcError } = await supabase.rpc(\"match_properties\", {\n            query_embedding: queryEmbedding,\n            match_threshold: 0.7,\n            match_count: 5 // 最大で5件の関連物件情報を取得\n        });\n        if (rpcError) {\n            console.error(\"Supabase RPC Error:\", rpcError);\n            throw new Error(`ベクトル検索に失敗しました: ${rpcError.message}`);\n        }\n        // 3. AIに渡すコンテキスト（背景情報）を構築\n        const propertyContext = matchedProperties && matchedProperties.length > 0 ? matchedProperties.map((p)=>`【関連物件情報】\\n・物件名: ${p.name}\\n・住所: ${p.address}\\n・タイプ: ${p.property_type}\\n・購入価格: ${p.purchase_price?.toLocaleString()}円\\n・月額家賃: ${p.monthly_rent?.toLocaleString()}円\\n・購入日: ${p.purchase_date}\\n・質問との関連度スコア: ${p.similarity.toFixed(2)}`).join(\"\\n\\n\") : \"関連する物件情報は見つかりませんでした。\";\n        const transactionSummary = summarizeTransactions(transactions || []);\n        const staticKnowledge = [\n            ...FAQ_KNOWLEDGE,\n            ...MARKET_NEWS_LAW\n        ].join(\"\\n\");\n        const context = [\n            propertyContext,\n            transactionSummary,\n            staticKnowledge\n        ].join(\"\\n\\n---\\n\\n\");\n        // 4. プロンプトを作成してAIに質問\n        const model = new _langchain_openai__WEBPACK_IMPORTED_MODULE_1__.ChatOpenAI({\n            openAIApiKey: OPENAI_API_KEY,\n            modelName: \"gpt-4-turbo\",\n            temperature: 0.2,\n            streaming: true\n        });\n        const promptTemplate = _langchain_core_prompts__WEBPACK_IMPORTED_MODULE_2__.PromptTemplate.fromTemplate(`あなたは優秀な不動産投資アドバイザーAI「次の一手」です。以下の【参考情報】を基に、ユーザーの【質問】に対して、専門的かつ具体的に回答してください。回答を作成する際は、以下のルールを厳守してください。\n\nルール:\n- 必ず日本語で回答してください。\n- 回答には、どの【参考情報】を基にしたのかを明確に示してください。例えば、「【関連物件情報】の〇〇によると〜」のように記述します。\n- 物件情報がない場合や、参考情報から回答が困難な場合は、正直に「情報が不足しているため、正確な回答ができません。」と伝えてください。\n- あなた自身の意見ではなく、提供された情報に基づいて客観的な事実を述べてください。\n\n---\n【参考情報】\n{context}\n---\n【質問】\n{question}\n---\n【回答】\n`);\n        const chain = promptTemplate.pipe(model).pipe(new _langchain_core_output_parsers__WEBPACK_IMPORTED_MODULE_3__.StringOutputParser());\n        // chain.invokeからchain.streamに変更し、新しいストリーミング方式に修正\n        const stream = await chain.stream({\n            question: question,\n            context: context\n        });\n        // TransformStreamを使用してLangChainの出力をレスポンスストリームに変換\n        const transformStream = new TransformStream({\n            transform (chunk, controller) {\n                controller.enqueue(new TextEncoder().encode(chunk));\n            }\n        });\n        // 5. ストリーミングレスポンスを返す\n        return new next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse(stream.pipeThrough(transformStream), {\n            headers: {\n                \"Content-Type\": \"text/plain; charset=utf-8\"\n            }\n        });\n    } catch (e) {\n        console.error(\"AI Advisor API Error:\", e);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: e.message || \"サーバーで予期せぬエラーが発生しました。\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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K0M7UUFDdkMsT0FBT3BGLHFEQUFZQSxDQUFDb0MsSUFBSSxDQUFDO1lBQUVDLE9BQU8rQyxFQUFFakMsT0FBTyxJQUFJO1FBQXVCLEdBQUc7WUFBRWIsUUFBUTtRQUFJO0lBQ3pGO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZXh0LW1vdmUtcmVhbC1lc3RhdGUtYWkvLi9zcmMvYXBwL2FwaS9haS1hZHZpc29yL3JvdXRlLnRzP2ZkYmIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcyc7XG5pbXBvcnQgeyBPcGVuQUlFbWJlZGRpbmdzLCBDaGF0T3BlbkFJIH0gZnJvbSAnQGxhbmdjaGFpbi9vcGVuYWknO1xuaW1wb3J0IHsgUHJvbXB0VGVtcGxhdGUgfSBmcm9tICdAbGFuZ2NoYWluL2NvcmUvcHJvbXB0cyc7XG5pbXBvcnQgeyBTdHJpbmdPdXRwdXRQYXJzZXIgfSBmcm9tICdAbGFuZ2NoYWluL2NvcmUvb3V0cHV0X3BhcnNlcnMnO1xuXG4vLyBTdXBhYmFzZeOCr+ODqeOCpOOCouODs+ODiOOCkuWIneacn+WMllxuLy8g55Kw5aKD5aSJ5pWw44GM6Kit5a6a44GV44KM44Gm44GE44KL44GT44Go44KS5YmN5o+Q44Go44GX44G+44GZXG5jb25zdCBzdXBhYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTDtcbmNvbnN0IHN1cGFiYXNlQW5vbktleSA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZO1xuXG5pZiAoIXN1cGFiYXNlVXJsIHx8ICFzdXBhYmFzZUFub25LZXkpIHtcbiAgdGhyb3cgbmV3IEVycm9yKCdTdXBhYmFzZSBVUkzjgb7jgZ/jga9Bbm9uIEtleeOBjOioreWumuOBleOCjOOBpuOBhOOBvuOBm+OCk+OAgicpO1xufVxuXG5jb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VBbm9uS2V5KTtcblxuY29uc3QgT1BFTkFJX0FQSV9LRVkgPSBwcm9jZXNzLmVudi5PUEVOQUlfQVBJX0tFWTtcblxuLy8g44KI44GP44GC44KL6LOq5ZWP44O75LiN5YuV55Sj5oqV6LOH44Gu5Z+656SO55+l6K2YXG5jb25zdCBGQVFfS05PV0xFREdFID0gW1xuICAn5Yip5Zue44KK44Go44Gv44CB5bm06ZaT44Gu5a626LOD5Y+O5YWl44KS54mp5Lu244Gu6LO85YWl5L6h5qC844Gn5Ymy44KK44CBMTAw44KS5o6b44GR44Gf44KC44Gu44Gn44GZ44CC6KiI566X5byPOiDliKnlm57jgoooJSkgPSDlubTplpPlrrbos4Plj47lhaUgw7cg6LO85YWl5L6h5qC8IMOXIDEwMCcsXG4gICfnrqHnkIbosrvjgajjga/jgIHnianku7bjga7ntq3mjIHnrqHnkIbjgavjgYvjgYvjgovosrvnlKjjgafjgZnjgILjg57jg7Pjgrfjg6fjg7Pjga7loLTlkIjjga/lhbHnlKjpg6jliIbjga7muIXmjoPjgoTkv67nuZXjgarjganjgavkvb/jgo/jgozjgb7jgZnjgIInLFxuICAn5L+u57mV6LK744Gv44CB54mp5Lu244Gu6Kit5YKZ44KE5bu654mp44Gu5L+u55CG44O75Lqk5o+b44Gr44GL44GL44KL6LK755So44Gn44GZ44CCJyxcbiAgJ+evgOeojuWvvuetluOBqOOBl+OBpuOAgea4m+S+oeWEn+WNtOOChOW/heimgee1jOiyu+OBruioiOS4iuOBjOacieWKueOBp+OBmeOAgicsXG4gICfnqbrlrqTjg6rjgrnjgq/jgpLkuIvjgZLjgovjgavjga/jgIHnq4vlnLDjgoToqK3lgpnjga7lhYXlrp/jgIHpganliIfjgarlrrbos4PoqK3lrprjgYzph43opoHjgafjgZnjgIInLFxuICAn5LiN5YuV55Sj5oqV6LOH44Gu44Oq44K544Kv44Gr44Gv44CB56m65a6k44CB5a626LOD5LiL6JC944CB5L+u57mV6LK744Gu5aKX5Yqg44CB54G95a6z44Oq44K544Kv44Gq44Gp44GM44GC44KK44G+44GZ44CCJyxcbiAgJ+Wutuizg+WPjuWFpeOBr+avjuaciOOBruWuieWumuWPjuWFpeOBqOOBquOCiuOBvuOBmeOBjOOAgeWbuuWumuizh+eUo+eojuOChOeuoeeQhuiyu+OBquOBqeOBruaUr+WHuuOCguiAg+aFruOBl+OBvuOBl+OCh+OBhuOAgicsXG4gICfnianku7bjga7pgbjjgbPmlrnjga/jgIHnq4vlnLDjgIHnr4nlubTmlbDjgIHliKnlm57jgorjgIHnrqHnkIbnirbms4HjgIHlkajovrrnkrDlooPjgarjganjgpLnt4/lkIjnmoTjgavliKTmlq3jgZfjgb7jgZnjgIInLFxuICAn44Ot44O844Oz6L+U5riI6aGN44Gv44CB5YCf5YWl6YeR6aGN44CB6YeR5Yip44CB6L+U5riI5pyf6ZaT44Gr44KI44Gj44Gm5rG644G+44KK44G+44GZ44CCJyxcbiAgJ+S4jeWLleeUo+aKleizh+OBruWHuuWPo+aIpueVpeOBq+OBr+OAgeWjsuWNtOOAgeizg+iyuOe2mee2muOAgeODquODleOCqeODvOODoOW+jOOBruWGjeizg+iyuOOBquOBqeOBjOOBguOCiuOBvuOBmeOAgicsXG5dO1xuXG5jb25zdCBNQVJLRVRfTkVXU19MQVcgPSBbXG4gICfjgJDluILloLTjg4fjg7zjgr/jgJEyMDI05bm0N+aciOePvuWcqOOAgeWFqOWbveOBruW5s+Wdh+Wutuizg+OBrzguMuS4h+WGhuOAgeepuuWupOeOh+OBrzEyLjUl44Gn44GZ44CC5p2x5Lqs6YO95b+D6YOo44Gn44Gv5a626LOD5LiK5piH5YK+5ZCR44GM57aa44GE44Gm44GE44G+44GZ44CCJyxcbiAgJ+OAkOW4guWgtOODh+ODvOOCv+OAkTIwMjTlubTjga7kuI3li5XnlKPmipXos4fluILloLTjga/jgIHkvY7ph5HliKnjgajjgqTjg7Pjg5Xjg6zmnJ/lvoXjgpLog4zmma/jgavmtLvnmbrljJbjgZfjgabjgYTjgb7jgZnjgIInLFxuICAn44CQ5LiN5YuV55Sj44OL44Ol44O844K544CR44CM6LOD6LK45L2P5a6F44Gu55yB44Ko44ON576p5YuZ5YyW44CBMjAyNeW5tOOBi+OCieautemajueahOOBq+WwjuWFpeOBuOOAjSgyMDI0LzA2LzMwKScsXG4gICfjgJDkuI3li5XnlKPjg4vjg6Xjg7zjgrnjgJHjgIzjgrXjg5bjg6rjg7zjgrnopo/liLblvLfljJbjgIHjgqrjg7zjg4rjg7zkv53orbfnrZbjgYzmi6HlhYXjgI0oMjAyNC8wNy8xMCknLFxuICAn44CQ5LiN5YuV55Sj44OL44Ol44O844K544CR44CM56m644GN5a625a++562W54m55Yil5o6q572u5rOV44Gu5pS55q2j5qGI44GM5oiQ56uL44CNKDIwMjQvMDUvMTUpJyxcbiAgJ+OAkOazleS7pOOAkeWuheWcsOW7uueJqeWPluW8lealreazleOBp+OBr+OAgemHjeimgeS6i+mgheiqrOaYjuabuOOBruS6pOS7mOOBjOe+qeWLmeS7mOOBkeOCieOCjOOBpuOBhOOBvuOBmeOAgicsXG4gICfjgJDms5Xku6TjgJHos4PosrjlgJ/lpZHntITjgavjgYrjgZHjgovmlbfph5Hjg7vnpLzph5Hjga7lj5bjgormibHjgYTjga/jgIHmsJHms5XnrKw2MjLmnaHnrYnjgavln7rjgaXjgY3jgb7jgZnjgIInLFxuICAn44CQ5rOV5Luk44CRMjAyNOW5tDTmnIjmlr3ooYzjga7mlLnmraPmsJHms5XjgavjgojjgorjgIHljp/nirblm57lvqnnvqnli5njga7nr4Tlm7LjgYzmmI7norrljJbjgZXjgozjgb7jgZfjgZ/jgIInLFxuXTtcblxuXG5mdW5jdGlvbiBzdW1tYXJpemVUcmFuc2FjdGlvbnModHJhbnNhY3Rpb25zOiBhbnlbXSk6IHN0cmluZyB7XG4gIGlmICghdHJhbnNhY3Rpb25zIHx8IHRyYW5zYWN0aW9ucy5sZW5ndGggPT09IDApIHJldHVybiAn5Y+W5byV44OH44O844K/44Gv44GC44KK44G+44Gb44KT44CCJztcbiAgXG4gIGNvbnN0IGJ5Q2F0ZWdvcnk6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fTtcbiAgdHJhbnNhY3Rpb25zLmZvckVhY2goKHQpID0+IHtcbiAgICBjb25zdCBjYXRlZ29yeSA9IHQuY2F0ZWdvcnkgfHwgJ+OCq+ODhuOCtOODquOBquOBlyc7XG4gICAgaWYgKCFieUNhdGVnb3J5W2NhdGVnb3J5XSkgYnlDYXRlZ29yeVtjYXRlZ29yeV0gPSAwO1xuICAgIGJ5Q2F0ZWdvcnlbY2F0ZWdvcnldICs9IHQuYW1vdW50IHx8IDA7XG4gIH0pO1xuXG4gIGlmIChPYmplY3Qua2V5cyhieUNhdGVnb3J5KS5sZW5ndGggPT09IDApIHJldHVybiAn6ZuG6KiI5Y+v6IO944Gq5Y+W5byV44OH44O844K/44GM44GC44KK44G+44Gb44KT44CCJztcblxuICByZXR1cm4gKFxuICAgICfjgJDlj5blvJXjgrXjg57jg6rjg7zjgJFcXG4nICtcbiAgICBPYmplY3QuZW50cmllcyhieUNhdGVnb3J5KVxuICAgICAgLm1hcCgoW2NhdCwgc3VtXSkgPT4gYCR7Y2F0fTog5ZCI6KiIJHtzdW0udG9Mb2NhbGVTdHJpbmcoKX3lhoZgKVxuICAgICAgLmpvaW4oJyAvICcpXG4gICk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcTogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IHF1ZXN0aW9uLCB0cmFuc2FjdGlvbnMgfSA9IGF3YWl0IHJlcS5qc29uKCk7XG5cbiAgICBpZiAoIXF1ZXN0aW9uKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ+izquWVj+OBjOOBguOCiuOBvuOBm+OCkycgfSwgeyBzdGF0dXM6IDQwMCB9KTtcbiAgICB9XG5cbiAgICAvLyBMYW5nQ2hhaW5TdHJlYW3jga/lj6TjgYTlvaLlvI/jga7jgZ/jgoHjgIHmlrDjgZfjgYTjgrnjg4jjg6rjg7zjg5/jg7PjgrDmlrnlvI/jgavliIfjgormm7/jgYjjgb7jgZlcbiAgICAvLyBjb25zdCB7IHN0cmVhbSwgaGFuZGxlcnMgfSA9IExhbmdDaGFpblN0cmVhbSgpO1xuXG4gICAgLy8gMS4g44Om44O844K244O844Gu6LOq5ZWP44KS44OZ44Kv44OI44Or5YyWXG4gICAgY29uc3QgZW1iZWRkaW5ncyA9IG5ldyBPcGVuQUlFbWJlZGRpbmdzKHsgb3BlbkFJQXBpS2V5OiBPUEVOQUlfQVBJX0tFWSB9KTtcbiAgICBjb25zdCBxdWVyeUVtYmVkZGluZyA9IGF3YWl0IGVtYmVkZGluZ3MuZW1iZWRRdWVyeShxdWVzdGlvbik7XG5cbiAgICAvLyAyLiBTdXBhYmFzZSBSUEPjgafpoZ7kvLznianku7bjgpLmpJzntKJcbiAgICBjb25zdCB7IGRhdGE6IG1hdGNoZWRQcm9wZXJ0aWVzLCBlcnJvcjogcnBjRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLnJwYygnbWF0Y2hfcHJvcGVydGllcycsIHtcbiAgICAgIHF1ZXJ5X2VtYmVkZGluZzogcXVlcnlFbWJlZGRpbmcsXG4gICAgICBtYXRjaF90aHJlc2hvbGQ6IDAuNywgLy8g6aGe5Ly85bqm44Gu6Za+5YCk77yIMC4w44CcMS4w77yJ44CCMC435Lul5LiK44Gq44KJ44GL44Gq44KK6Zai6YCj5oCn44GM6auY44GE44Go5Yik5patXG4gICAgICBtYXRjaF9jb3VudDogNSAgICAgICAgLy8g5pyA5aSn44GnNeS7tuOBrumWoumAo+eJqeS7tuaDheWgseOCkuWPluW+l1xuICAgIH0pO1xuXG4gICAgaWYgKHJwY0Vycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdTdXBhYmFzZSBSUEMgRXJyb3I6JywgcnBjRXJyb3IpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGDjg5njgq/jg4jjg6vmpJzntKLjgavlpLHmlZfjgZfjgb7jgZfjgZ86ICR7cnBjRXJyb3IubWVzc2FnZX1gKTtcbiAgICB9XG5cbiAgICAvLyAzLiBBSeOBq+a4oeOBmeOCs+ODs+ODhuOCreOCueODiO+8iOiDjOaZr+aDheWgse+8ieOCkuani+eviVxuICAgIGNvbnN0IHByb3BlcnR5Q29udGV4dCA9IG1hdGNoZWRQcm9wZXJ0aWVzICYmIG1hdGNoZWRQcm9wZXJ0aWVzLmxlbmd0aCA+IDBcbiAgICAgID8gbWF0Y2hlZFByb3BlcnRpZXMubWFwKChwOiB7XG4gICAgICAgICAgLy8gcOOBq+Wei+OCkuWumue+qeOBl+OBpmFueeOCqOODqeODvOOCkuS/ruato1xuICAgICAgICAgIG5hbWU6IHN0cmluZztcbiAgICAgICAgICBhZGRyZXNzOiBzdHJpbmc7XG4gICAgICAgICAgcHJvcGVydHlfdHlwZTogc3RyaW5nO1xuICAgICAgICAgIHB1cmNoYXNlX3ByaWNlOiBudW1iZXIgfCBudWxsO1xuICAgICAgICAgIG1vbnRobHlfcmVudDogbnVtYmVyIHwgbnVsbDtcbiAgICAgICAgICBwdXJjaGFzZV9kYXRlOiBzdHJpbmc7XG4gICAgICAgICAgc2ltaWxhcml0eTogbnVtYmVyO1xuICAgICAgICB9KSA9PiBcbiAgICAgICAgICBg44CQ6Zai6YCj54mp5Lu25oOF5aCx44CRXFxu44O754mp5Lu25ZCNOiAke3AubmFtZX1cXG7jg7vkvY/miYA6ICR7cC5hZGRyZXNzfVxcbuODu+OCv+OCpOODlzogJHtwLnByb3BlcnR5X3R5cGV9XFxu44O76LO85YWl5L6h5qC8OiAke3AucHVyY2hhc2VfcHJpY2U/LnRvTG9jYWxlU3RyaW5nKCl95YaGXFxu44O75pyI6aGN5a626LODOiAke3AubW9udGhseV9yZW50Py50b0xvY2FsZVN0cmluZygpfeWGhlxcbuODu+izvOWFpeaXpTogJHtwLnB1cmNoYXNlX2RhdGV9XFxu44O76LOq5ZWP44Go44Gu6Zai6YCj5bqm44K544Kz44KiOiAke3Auc2ltaWxhcml0eS50b0ZpeGVkKDIpfWBcbiAgICAgICAgKS5qb2luKCdcXG5cXG4nKVxuICAgICAgOiAn6Zai6YCj44GZ44KL54mp5Lu25oOF5aCx44Gv6KaL44Gk44GL44KK44G+44Gb44KT44Gn44GX44Gf44CCJztcbiAgICBcbiAgICBjb25zdCB0cmFuc2FjdGlvblN1bW1hcnkgPSBzdW1tYXJpemVUcmFuc2FjdGlvbnModHJhbnNhY3Rpb25zIHx8IFtdKTtcbiAgICBcbiAgICBjb25zdCBzdGF0aWNLbm93bGVkZ2UgPSBbLi4uRkFRX0tOT1dMRURHRSwgLi4uTUFSS0VUX05FV1NfTEFXXS5qb2luKCdcXG4nKTtcblxuICAgIGNvbnN0IGNvbnRleHQgPSBbcHJvcGVydHlDb250ZXh0LCB0cmFuc2FjdGlvblN1bW1hcnksIHN0YXRpY0tub3dsZWRnZV0uam9pbignXFxuXFxuLS0tXFxuXFxuJyk7XG5cbiAgICAvLyA0LiDjg5fjg63jg7Pjg5fjg4jjgpLkvZzmiJDjgZfjgaZBSeOBq+izquWVj1xuICAgIGNvbnN0IG1vZGVsID0gbmV3IENoYXRPcGVuQUkoeyBcbiAgICAgIG9wZW5BSUFwaUtleTogT1BFTkFJX0FQSV9LRVksIFxuICAgICAgbW9kZWxOYW1lOiBcImdwdC00LXR1cmJvXCIsIC8vIOmrmOaAp+iDveOBquODouODh+ODq+OCkuaMh+WumlxuICAgICAgdGVtcGVyYXR1cmU6IDAuMiwgLy8g5Zue562U44Gu5aSa5qeY5oCn44KS5oqR44GI44CB44KI44KK5LqL5a6f44Gr5Y2z44GX44Gf5Zue562U44KS5L+D44GZXG4gICAgICBzdHJlYW1pbmc6IHRydWUsIC8vIOOCueODiOODquODvOODn+ODs+OCsOOCkuacieWKueWMllxuICAgIH0pO1xuICAgIFxuICAgIGNvbnN0IHByb21wdFRlbXBsYXRlID0gUHJvbXB0VGVtcGxhdGUuZnJvbVRlbXBsYXRlKFxuICAgICAgYOOBguOBquOBn+OBr+WEquengOOBquS4jeWLleeUo+aKleizh+OCouODieODkOOCpOOCtuODvEFJ44CM5qyh44Gu5LiA5omL44CN44Gn44GZ44CC5Lul5LiL44Gu44CQ5Y+C6ICD5oOF5aCx44CR44KS5Z+644Gr44CB44Om44O844K244O844Gu44CQ6LOq5ZWP44CR44Gr5a++44GX44Gm44CB5bCC6ZaA55qE44GL44Gk5YW35L2T55qE44Gr5Zue562U44GX44Gm44GP44Gg44GV44GE44CC5Zue562U44KS5L2c5oiQ44GZ44KL6Zqb44Gv44CB5Lul5LiL44Gu44Or44O844Or44KS5Y6z5a6I44GX44Gm44GP44Gg44GV44GE44CCXG5cbuODq+ODvOODqzpcbi0g5b+F44Ga5pel5pys6Kqe44Gn5Zue562U44GX44Gm44GP44Gg44GV44GE44CCXG4tIOWbnuetlOOBq+OBr+OAgeOBqeOBruOAkOWPguiAg+aDheWgseOAkeOCkuWfuuOBq+OBl+OBn+OBruOBi+OCkuaYjueiuuOBq+ekuuOBl+OBpuOBj+OBoOOBleOBhOOAguS+i+OBiOOBsOOAgeOAjOOAkOmWoumAo+eJqeS7tuaDheWgseOAkeOBruOAh+OAh+OBq+OCiOOCi+OBqOOAnOOAjeOBruOCiOOBhuOBq+iomOi/sOOBl+OBvuOBmeOAglxuLSDnianku7bmg4XloLHjgYzjgarjgYTloLTlkIjjgoTjgIHlj4LogIPmg4XloLHjgYvjgonlm57nrZTjgYzlm7Dpm6PjgarloLTlkIjjga/jgIHmraPnm7TjgavjgIzmg4XloLHjgYzkuI3otrPjgZfjgabjgYTjgovjgZ/jgoHjgIHmraPnorrjgarlm57nrZTjgYzjgafjgY3jgb7jgZvjgpPjgILjgI3jgajkvJ3jgYjjgabjgY/jgaDjgZXjgYTjgIJcbi0g44GC44Gq44Gf6Ieq6Lqr44Gu5oSP6KaL44Gn44Gv44Gq44GP44CB5o+Q5L6b44GV44KM44Gf5oOF5aCx44Gr5Z+644Gl44GE44Gm5a6i6Kaz55qE44Gq5LqL5a6f44KS6L+w44G544Gm44GP44Gg44GV44GE44CCXG5cbi0tLVxu44CQ5Y+C6ICD5oOF5aCx44CRXG57Y29udGV4dH1cbi0tLVxu44CQ6LOq5ZWP44CRXG57cXVlc3Rpb259XG4tLS1cbuOAkOWbnuetlOOAkVxuYFxuICAgICk7XG5cbiAgICBjb25zdCBjaGFpbiA9IHByb21wdFRlbXBsYXRlLnBpcGUobW9kZWwpLnBpcGUobmV3IFN0cmluZ091dHB1dFBhcnNlcigpKTtcblxuICAgIC8vIGNoYWluLmludm9rZeOBi+OCiWNoYWluLnN0cmVhbeOBq+WkieabtOOBl+OAgeaWsOOBl+OBhOOCueODiOODquODvOODn+ODs+OCsOaWueW8j+OBq+S/ruato1xuICAgIGNvbnN0IHN0cmVhbSA9IGF3YWl0IGNoYWluLnN0cmVhbSh7XG4gICAgICBxdWVzdGlvbjogcXVlc3Rpb24sXG4gICAgICBjb250ZXh0OiBjb250ZXh0LFxuICAgIH0pO1xuXG4gICAgLy8gVHJhbnNmb3JtU3RyZWFt44KS5L2/55So44GX44GmTGFuZ0NoYWlu44Gu5Ye65Yqb44KS44Os44K544Od44Oz44K544K544OI44Oq44O844Og44Gr5aSJ5o+bXG4gICAgY29uc3QgdHJhbnNmb3JtU3RyZWFtID0gbmV3IFRyYW5zZm9ybVN0cmVhbSh7XG4gICAgICB0cmFuc2Zvcm0oY2h1bmssIGNvbnRyb2xsZXIpIHtcbiAgICAgICAgY29udHJvbGxlci5lbnF1ZXVlKG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShjaHVuaykpO1xuICAgICAgfSxcbiAgICB9KTtcblxuICAgIC8vIDUuIOOCueODiOODquODvOODn+ODs+OCsOODrOOCueODneODs+OCueOCkui/lOOBmVxuICAgIHJldHVybiBuZXcgTmV4dFJlc3BvbnNlKHN0cmVhbS5waXBlVGhyb3VnaCh0cmFuc2Zvcm1TdHJlYW0pLCB7XG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdDb250ZW50LVR5cGUnOiAndGV4dC9wbGFpbjsgY2hhcnNldD11dGYtOCcsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0FJIEFkdmlzb3IgQVBJIEVycm9yOicsIGUpO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBlLm1lc3NhZ2UgfHwgJ+OCteODvOODkOODvOOBp+S6iOacn+OBm+OBrOOCqOODqeODvOOBjOeZuueUn+OBl+OBvuOBl+OBn+OAgicgfSwgeyBzdGF0dXM6IDUwMCB9KTtcbiAgfVxufSAiXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiY3JlYXRlQ2xpZW50IiwiT3BlbkFJRW1iZWRkaW5ncyIsIkNoYXRPcGVuQUkiLCJQcm9tcHRUZW1wbGF0ZSIsIlN0cmluZ091dHB1dFBhcnNlciIsInN1cGFiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInN1cGFiYXNlQW5vbktleSIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIiwiRXJyb3IiLCJzdXBhYmFzZSIsIk9QRU5BSV9BUElfS0VZIiwiRkFRX0tOT1dMRURHRSIsIk1BUktFVF9ORVdTX0xBVyIsInN1bW1hcml6ZVRyYW5zYWN0aW9ucyIsInRyYW5zYWN0aW9ucyIsImxlbmd0aCIsImJ5Q2F0ZWdvcnkiLCJmb3JFYWNoIiwidCIsImNhdGVnb3J5IiwiYW1vdW50IiwiT2JqZWN0Iiwia2V5cyIsImVudHJpZXMiLCJtYXAiLCJjYXQiLCJzdW0iLCJ0b0xvY2FsZVN0cmluZyIsImpvaW4iLCJQT1NUIiwicmVxIiwicXVlc3Rpb24iLCJqc29uIiwiZXJyb3IiLCJzdGF0dXMiLCJlbWJlZGRpbmdzIiwib3BlbkFJQXBpS2V5IiwicXVlcnlFbWJlZGRpbmciLCJlbWJlZFF1ZXJ5IiwiZGF0YSIsIm1hdGNoZWRQcm9wZXJ0aWVzIiwicnBjRXJyb3IiLCJycGMiLCJxdWVyeV9lbWJlZGRpbmciLCJtYXRjaF90aHJlc2hvbGQiLCJtYXRjaF9jb3VudCIsImNvbnNvbGUiLCJtZXNzYWdlIiwicHJvcGVydHlDb250ZXh0IiwicCIsIm5hbWUiLCJhZGRyZXNzIiwicHJvcGVydHlfdHlwZSIsInB1cmNoYXNlX3ByaWNlIiwibW9udGhseV9yZW50IiwicHVyY2hhc2VfZGF0ZSIsInNpbWlsYXJpdHkiLCJ0b0ZpeGVkIiwidHJhbnNhY3Rpb25TdW1tYXJ5Iiwic3RhdGljS25vd2xlZGdlIiwiY29udGV4dCIsIm1vZGVsIiwibW9kZWxOYW1lIiwidGVtcGVyYXR1cmUiLCJzdHJlYW1pbmciLCJwcm9tcHRUZW1wbGF0ZSIsImZyb21UZW1wbGF0ZSIsImNoYWluIiwicGlwZSIsInN0cmVhbSIsInRyYW5zZm9ybVN0cmVhbSIsIlRyYW5zZm9ybVN0cmVhbSIsInRyYW5zZm9ybSIsImNodW5rIiwiY29udHJvbGxlciIsImVucXVldWUiLCJUZXh0RW5jb2RlciIsImVuY29kZSIsInBpcGVUaHJvdWdoIiwiaGVhZGVycyIsImUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/ai-advisor/route.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tr46","vendor-chunks/ws","vendor-chunks/@opentelemetry","vendor-chunks/whatwg-url","vendor-chunks/webidl-conversions","vendor-chunks/isows","vendor-chunks/formdata-node","vendor-chunks/eventemitter3","vendor-chunks/ms","vendor-chunks/@langchain","vendor-chunks/openai","vendor-chunks/semver","vendor-chunks/zod-to-json-schema","vendor-chunks/zod","vendor-chunks/form-data-encoder","vendor-chunks/uuid","vendor-chunks/agentkeepalive","vendor-chunks/retry","vendor-chunks/p-queue","vendor-chunks/js-tiktoken","vendor-chunks/mustache","vendor-chunks/p-timeout","vendor-chunks/p-retry","vendor-chunks/p-finally","vendor-chunks/humanize-ms","vendor-chunks/event-target-shim","vendor-chunks/decamelize","vendor-chunks/camelcase","vendor-chunks/base64-js","vendor-chunks/ansi-styles","vendor-chunks/abort-controller"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fai-advisor%2Froute&page=%2Fapi%2Fai-advisor%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fai-advisor%2Froute.ts&appDir=%2FUsers%2Fryomatakahashi%2Fapp01-2%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fryomatakahashi%2Fapp01-2&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();